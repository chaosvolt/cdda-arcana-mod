[
  {
    "id": "TALK_EVAC_MERCHANT",
    "type": "talk_topic",
    "responses": [
      {
        "text": "Do you know of any other settlements in the region?",
        "topic": "TALK_EVAC_MERCHANT_CF",
        "effect": [
          { "npc_add_effect": "rural_church_aware", "duration": "PERMANENT" },
          { "u_add_effect": "rural_church_aware", "duration": "PERMANENT" },
          {
            "mapgen_update": "arcana_dummy",
            "om_terrain": "cf_church_4",
            "om_special": "cf_rural_church",
            "om_terrain_replace": "field",
            "random": true,
            "reveal_radius": 3
          }
        ],
        "condition": { "not": { "npc_has_effect": "rural_church_aware" } }
      },
      {
        "text": "Do you know of any other settlements in the region?",
        "topic": "TALK_EVAC_MERCHANT_CF",
        "effect": [
          { "u_add_effect": "rural_church_aware", "duration": "PERMANENT" },
          {
            "mapgen_update": "arcana_dummy",
            "om_terrain": "cf_church_4",
            "om_special": "cf_rural_church",
            "reveal_radius": 3
          }
        ],
        "condition": { "and": [ { "not": { "u_has_effect": "rural_church_aware" } }, { "npc_has_effect": "rural_church_aware" } ] }
      },
      {
        "text": "[MISSION] Sofia sent me with the latest inventory for trading.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION",
        "condition": {
          "and": [
            { "u_has_item": "cf_rep_trade_arrangement" },
            { "u_has_mission": "MISSION_CF_REP_2" },
            { "not": { "npc_has_effect": "cf_mission_receipt" } }
          ]
        }
      },
      {
        "text": "[MISSION] Can you print another copy of the receipt?",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_RECEIPT",
        "condition": {
          "and": [
            { "not": { "u_has_item": "cf_rep_trade_receipt" } },
            { "u_has_mission": "MISSION_CF_REP_2" },
            { "npc_has_effect": "cf_mission_receipt" }
          ]
        }
      }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF",
    "type": "talk_topic",
    "dynamic_line": "Not many holdouts large enough to call a settlement, but there is activity out there at least.  We have our own work on getting something set up.  There's also a small group that occasionally sends traders to visit us, they're holed up in some old rural church.  I'll mark it on your map as best as I can.  The church's deacon stops by here fairly often though, should be out in the hallway.  Talk to him and he might be able to tell you more.",
    "responses": [ { "text": "Thank you.  I'll be back later.", "topic": "TALK_DONE" } ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION",
    "type": "talk_topic",
    "dynamic_line": {
      "u_has_effect": "rural_church_aware",
      "yes": "Interesting to see they hired you to help out.  Well then, hope they informed you of the details.  Payment's in advance, twenty of their scale coins.  Nowhere near as valuable these days, but it's not completely useless, and I trust what they bring to actually be twenty-four carat.",
      "no": "Huh, usually Sofia's the one to deliver their invoice.  Alright, hopefully she told you how this works.  Payment's in advance, twenty of their scale coins.  Nowhere near as valuable these days, but it's not completely useless, and at least they can comfirm it's not half brass or whatever."
    },
    "responses": [
      {
        "text": "Here you go!",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "u_has_items": { "item": "CF_golden_scale", "count": 20 } },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_consume_item": "CF_golden_scale", "count": 20 } ]
      },
      {
        "text": "How about 15 scales?",
        "condition": { "u_has_items": { "item": "CF_golden_scale", "count": 15 } },
        "trial": { "type": "PERSUADE", "difficulty": 10 },
        "success": { "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL", "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_consume_item": "CF_golden_scale", "count": 15 } ] },
        "failure": { "opinion": { "value": -1 }, "topic": "TALK_EVAC_MERCHANT_CF_MISSION_NODEAL" }
      },
      {
        "text": "What about other sources of gold and silver?",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_SCRAP"
      },
      { "text": "What about cash?", "topic": "TALK_EVAC_MERCHANT_CF_MISSION_CASH" },
      {
        "text": "I don't have enough on hand on the moment.  I'll deal with this later.",
        "topic": "TALK_EVAC_MERCHANT",
        "condition": { "not": { "u_has_items": { "item": "CF_golden_scale", "count": 20 } } }
      },
      { "text": "I'll deal with this later, bye for now.", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION_SCRAP",
    "type": "talk_topic",
    "dynamic_line": "Afraid I can't.  The main reason I'm willing to honor their deal is because those things they use are reliable.  25 grams of three-nines-fine gold, edge reeding, the works.  I doubt they have the means to make any more, but for now they're more useful for trade than any old melted jewelry.",
    "responses": [
      {
        "text": "Okay, here are the coins.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "u_has_items": { "item": "CF_golden_scale", "count": 20 } },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_consume_item": "CF_golden_scale", "count": 20 } ]
      },
      {
        "text": "Could you accept 15 instead?",
        "condition": { "u_has_items": { "item": "CF_golden_scale", "count": 15 } },
        "trial": { "type": "PERSUADE", "difficulty": 10 },
        "success": { "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL", "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_consume_item": "CF_golden_scale", "count": 15 } ] },
        "failure": { "opinion": { "value": -1 }, "topic": "TALK_EVAC_MERCHANT_CF_MISSION_NODEAL" }
      },
      { "text": "What about cash?", "topic": "TALK_EVAC_MERCHANT_CF_MISSION_CASH" },
      { "text": "Nevermind.  I'll come back later.", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION_CASH",
    "type": "talk_topic",
    "dynamic_line": "If you have the merch, sure.  I've accepted that group's offers mostly since they've been reliable customers.  I've been honoring them at about fifty percent a Certified Note each, so that'll be 10 merch.",
    "responses": [
      {
        "text": "You have a deal.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "u_has_items": { "item": "FMCNote", "count": 10 } },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_consume_item": "FMCNote", "count": 10 } ]
      },
      {
        "text": "On second thought, I'll pay in scales.  Here you go.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "and": [ { "u_has_items": { "item": "FMCNote", "count": 10 } }, { "u_has_items": { "item": "CF_golden_scale", "count": 20 } } ] },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_consume_item": "CF_golden_scale", "count": 20 } ]
      },
      {
        "text": "I don't have enough cash, so I'll pay in gold.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "and": [ { "not": { "u_has_items": { "item": "FMCNote", "count": 10 } } }, { "u_has_items": { "item": "CF_golden_scale", "count": 20 } } ] },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_consume_item": "CF_golden_scale", "count": 20 } ]
      },
      { "text": "Nevermind.  I'll be back later.", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
    "type": "talk_topic",
    "dynamic_line": "Pleasure doing business with you.  I'll have my men set up the next caravan with the usual instructions and put together their inventory based on Sofia's recommendations.  Let me print up the receipt.",
    "responses": [
      {
        "text": "Thank you.  I'll bring this back to her.",
        "topic": "TALK_DONE",
        "effect": [
          { "npc_add_effect": "cf_mission_receipt", "duration": "PERMANENT" },
          { "u_add_effect": "cf_mission_receipt", "duration": "PERMANENT" },
          { "u_buy_item": "cf_rep_trade_receipt" }
        ]
      }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION_NODEAL",
    "type": "talk_topic",
    "dynamic_line": "Sorry, 20 golden scales is as low as I can.  Gold's not as handy now that the world's ended. I'm already honoring half its old value.",
    "responses": [
      {
        "text": "Okay, here you go.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "u_has_items": { "item": "CF_golden_scale", "count": 20 } },
        "effect": { "u_consume_item": "CF_golden_scale", "count": 20 }
      },
      { "text": "Nevermind, I'll be back later on.", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION_RECEIPT",
    "type": "talk_topic",
    "dynamic_line": "Alright.  Try not to lose this one.",
    "responses": [ { "text": "Thank you, I'll go bring this to her.", "topic": "TALK_DONE", "effect": { "u_buy_item": "cf_rep_trade_receipt" } } ]
  }
]
